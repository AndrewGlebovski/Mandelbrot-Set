# Mandelbrot Set


![result](assets/result.png "Множество Мандельброта")


## Использование


Скомпилировать проект можно с помощью команды (**вам потребуется библиотека sfml**)
```
make
```

Приближение/отдаление камеры работают на колесико мыши, движение камеры через стрелочки.

Размер окна приложения и палитры, максимальное число итераций, скорость движения и приближения камеры задаются в configs.hpp (**изменения параметров требуют перекомпиляции**). Палитра цветов задается в файле assets/ColorTable.txt.


## Цель


Научиться оптимизировать однотипные вычисления на CPU с помощью SIMD.


## Введение


Множество Мандельброта - является одним из наиболее известных фракталов, а также интересной задачей с точки зрения оптимизации, поскольку цвет каждого пикселя вычисляется по следующей рекуррентной формуле.

```
x_n+1 = x_n^2 - y_n^2 + x_0
y_n+1 = 2*x_n*y_n + y_0
```

Этот процесс продолжается, пока расстояние от N-ой точки не станет больше 4320. Если значение N равно 255, то цикл прекращается.

Цвет пикселя рассчитывается по следующему правилу.

```
Если 0 < N < 255, то красим пиксель в  цвет из палитры по индексу N % 16;
Иначе красим пиксель в черный
```


## Ход работы


Сначала будем вычислять цвет каждого "наивным" образом, т.е. по одному пикселю за итерацию внутреннего цикла. Далее воспользуемся SIMD и будем считать по 8 пикселей за итерацию (команды AVX2 используют регистры на 256 бит, значит в один регистр помещается 8 float чисел). Замерим и сравним FPS в обоих случаях.


## Результат


**Условия**
- Все измерения производились с опцией -O3 компилятора gcc, а также набором инструкций AVX2.
- Для того, чтобы уменьшить влияние факторов, не связанных с вычислением множества, я вычисляю каждый пиксель по 100 раз после чего умножаю полученный FPS на 100.
- Компьютер был подключен к сети, замеры проводились при одной температуре (чтобы избежать искажения FPS из-за троттлинга CPU).

Средний FPS:

| SIMD | FPS |
| ---- | --- |
| Off  | 8   |
| On   | 56  |

Коэффициент ускорения:

|                | Коэффициент ускорения |
| -------------- | --------------------- |
| Теоретический  | 8                     |
| Практический   | 7                     |


## Вывод


SIMD позволяют добиться высоких коэффициентов ускорения за счет исполнения нескольких итераций цикла одновременно, однако для этого требуется использовать специальные ассемблерные вставки (интринсики), так как компилятор не способен сам выполнить такую оптимизацию.
